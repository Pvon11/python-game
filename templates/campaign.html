<!DOCTYPE html>
<html>

<head>
    <title>Rock Paper Scissors</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center">Rock Paper Scissors Game</h1>
        <div class="row justify-content-center mt-3">
            <div class="col-sm-6">
                <button id="playGameBtn" class="btn btn-primary">Play Game</button>
                <form id="gameForm" method="post" class="text-center" style="display: none;">
                    <div class="form-group">
                        <label for="player_choice">Enter your choice (rock, paper, scissors):</label>
                        <input type="text" class="form-control" id="player_choice" name="player_choice" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Play</button>
                </form>
            </div>
        </div>
        <div class="row justify-content-center mt-5">
            <div class="col-sm-6">
                <div id="gameResults" class="card text-center" style="display: none;">
                    <div class="card-header">
                        <h3>Results</h3>
                    </div>
                    <div class="card-body">
                        <p class="card-text">Player chose: <span id="playerChoiceResult"></span></p>
                        <p class="card-text">Computer chose: <span id="computerChoiceResult"></span></p>
                        <p class="card-text" id="roundResult"></p>
                        <img id="opponentImage" src="" alt="">
                        <a id="playAgainBtn" class="btn btn-primary">Play Again</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const playGameBtn = document.getElementById("playGameBtn");
        const gameForm = document.getElementById("gameForm");
        const gameResults = document.getElementById("gameResults");
        const playerChoiceResult = document.getElementById("playerChoiceResult");
        const computerChoiceResult = document.getElementById("computerChoiceResult");
        const roundResult = document.getElementById("roundResult");
        const playAgainBtn = document.getElementById("playAgainBtn");
        const opponentImage = document.getElementById("opponentImage");

        playGameBtn.addEventListener("click", function () {
            playGameBtn.style.display = "none";
            gameForm.style.display = "block";
            gameResults.style.display = "none";
            playerChoiceResult.textContent = "";
            computerChoiceResult.textContent = "";
            roundResult.textContent = "";

            // Disable the form input and play button until the user submits the choice
            document.getElementById("player_choice").disabled = false;
            document.querySelector("#gameForm button[type='submit']").disabled = false;

            // Fetch the computer opponents data from the server
            fetch("/game_data")
                .then(response => response.json())
                .then(data => {
                    const computerOpponents = data;

                    // Set the opponent image when the game starts
                    opponentImage.src = "/static/" + computerOpponents[0].image;
                    opponentImage.alt = computerOpponents[0].name;
                })
                .catch(error => console.error("Error fetching game data:", error));
        });

        gameForm.addEventListener("submit", function (event) {
            event.preventDefault();
            const playerChoice = document.getElementById("player_choice").value.trim().toLowerCase();

            // Enable the playGameBtn and disable the gameForm after each round
            playGameBtn.style.display = "block";
            gameForm.style.display = "none";
            gameResults.style.display = "block";
            document.getElementById("player_choice").disabled = true;
            document.querySelector("#gameForm button[type='submit']").disabled = true;
        });

        playAgainBtn.addEventListener("click", function () {
            // Reset the game state and start a new campaign round
            // Display the form to start a new round
            playGameBtn.style.display = "none";
            gameForm.style.display = "block";
            gameResults.style.display = "none";
            playerChoiceResult.textContent = "";
            computerChoiceResult.textContent = "";
            roundResult.textContent = "";

            // Enable the form input and play button
            document.getElementById("player_choice").disabled = false;
            document.querySelector("#gameForm button[type='submit']").disabled = false;
        });

        function setOpponentImage(opponentIndex) {
            // Get the opponent object from the computer_opponents array
            const selectedOpponent = computer_opponents[opponentIndex];
            // Set the image source based on the selected opponent's image property
            opponentImage.src = `/static/${selectedOpponent.image}`;
            // Set the alt text for the image
            opponentImage.alt = selectedOpponent.name;
        }

        // Call the setOpponentImage function to display the default opponent image when the page loads
        setOpponentImage(0); 
    </script>
</body>

</html>